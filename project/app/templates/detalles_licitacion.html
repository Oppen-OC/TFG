{% extends 'base.html' %}

{% block title %}Detalles de la Licitaci贸n{% endblock %}

{% block content %}
<h2 class="mb-4">Detalles de la Licitaci贸n</h2>

<table class="table table-bordered">
  <tr>
    <th>C贸digo</th>
    <td>{{ licitacion.COD }}</td>
  </tr>
  <tr>
    <th>ID Publicaci贸n TED</th>
    <td>{{ licitacion.ID_publicacion_TED }}</td>
  </tr>
  <tr>
    <th>rgano de Contrataci贸n</th>
    <td>{{ licitacion.Organo_Contratacion }}</td>
  </tr>
  <tr>
    <th>ID rgano de Contrataci贸n</th>
    <td>{{ licitacion.ID_Organo_contratacion }}</td>
  </tr>
  <tr>
    <th>Estado de la Licitaci贸n</th>
    <td>{{ licitacion.Estado_Licitacion }}</td>
  </tr>
  <tr>
    <th>Objeto del Contrato</th>
    <td>{{ licitacion.Objeto_contrato }}</td>
  </tr>
  <tr>
    <th>Financiaci贸n UE</th>
    <td>{{ licitacion.Financiacion_UE }}</td>
  </tr>
  <tr>
    <th>Presupuesto Base</th>
    <td>{{ licitacion.Presupuesto_base }}</td>
  </tr>
  <tr>
    <th>Valor Estimado del Contrato</th>
    <td>{{ licitacion.Valor_Estimado_Contrato }}</td>
  </tr>
  <tr>
    <th>Tipo de Contrato</th>
    <td>{{ licitacion.Tipo_contrato }}</td>
  </tr>
  <tr>
    <th>C贸digo CPV</th>
    <td>{{ licitacion.Codigo_CPV }}</td>
  </tr>
  <tr>
    <th>Lugar de Ejecuci贸n</th>
    <td>{{ licitacion.Lugar_ejecucion }}</td>
  </tr>
  <tr>
    <th>Sistema de Contrataci贸n</th>
    <td>{{ licitacion.Sistema_contratacion }}</td>
  </tr>
  <tr>
    <th>Procedimiento de Contrataci贸n</th>
    <td>{{ licitacion.Procedimiento_contratacion }}</td>
  </tr>
  <tr>
    <th>Tipo de Contrataci贸n</th>
    <td>{{ licitacion.Tipo_contratacion }}</td>
  </tr>
  <tr>
    <th>M茅todo de Presentaci贸n de Oferta</th>
    <td>{{ licitacion.Metodo_presentacion_oferta }}</td>
  </tr>
  <tr>
    <th>Resultado</th>
    <td>{{ licitacion.Resultado }}</td>
  </tr>
  <tr>
    <th>Adjudicatario</th>
    <td>{{ licitacion.Adjudicatario }}</td>
  </tr>
  <tr>
    <th>N煤mero de Licitaciones Presentadas</th>
    <td>{{ licitacion.Numero_licitaciones_presentadas }}</td>
  </tr>
  <tr>
    <th>Importe de Adjudicaci贸n</th>
    <td>{{ licitacion.Importe_adjudicacion }}</td>
  </tr>
</table>

<!-- Enlaces a los documentos -->
<h3 class="mt-5">Documentos Relacionados</h3>
<ul>
  {% if pliego_administrativo_url %}
  <li><a href="{{ pliego_administrativo_url}}" target="_blank"> Pliego Administrativo</a></li>
  {% else %}
  <li> Pliego Administrativo: No disponible</li>
  {% endif %}

  {% if anexo_url %}
  <li>
    <a href="{{ anexo_url }}" target="_blank">
       {{ titulo_anexo }}
    </a>
  </li>
  {% else %}
  <li> Anexo: No disponible</li>
  {% endif %}
</ul>

{% if anexo_url %}
<h3 class="mt-5">Detalles del Anexo</h3>
<table class="table table-bordered">
  <tr>
    <th>Regulaci贸n Armonizada</th>
    <td>
      {{ anexoI.Regulacion_armonizada }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Regulacion_armonizada')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Sometido a Recurso Especial</th>
    <td>
      {{ anexoI.Sometido_recurso_especial }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Sometido_recurso_especial')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Plazo de Ejecuci贸n</th>
    <td>
      {{ anexoI.Plazo_ejecuci贸n }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Plazo_ejecuci贸n')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Presupuesto sin IVA</th>
    <td>
      {{ anexoI.Presupuesto_sinIVA }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Presupuesto_sinIVA')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Presupuesto con IVA</th>
    <td>
      {{ anexoI.Presupuesto_conIVA }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Presupuesto_conIVA')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Importe IVA</th>
    <td>
      {{ anexoI.Importe_IVA }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Importe_IVA')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Sistema de Retribuci贸n</th>
    <td>
      {{ anexoI.Sistema_Retribucion }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Sistema_Retribucion')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Valor Estimado</th>
    <td>
      {{ anexoI.Valor_estimado }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Valor_estimado')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Revisi贸n de Precios</th>
    <td>
      {{ anexoI.Revision_precios }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Revision_precios')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Garant铆a Definitiva</th>
    <td>
      {{ anexoI.Garantia_definitiva }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Garantia_definitiva')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Garant铆a Provisional</th>
    <td>
      {{ anexoI.Garantia_provisional }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Garantia_provisional')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Admisibilidad de Variantes</th>
    <td>
      {{ anexoI.Admisibilidad_variantes }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Admisibilidad_variantes')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Clasificaci贸n</th>
    <td>
      {{ anexoI.Clasificacion }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Clasificacion')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Grupo</th>
    <td>
      {{ anexoI.Grupo }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Grupo')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Subgrupo</th>
    <td>
      {{ anexoI.Subgrupo }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Subgrupo')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Categor铆a</th>
    <td>
      {{ anexoI.Categoria }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Categoria')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Criterio de Solvencia Econ贸mica</th>
    <td>
      {{ anexoI.Criterio_Solvencia_economica }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Criterio_Solvencia_economica')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Criterio de Solvencia T茅cnica</th>
    <td>
      {{ anexoI.Criterio_Solvencia_tecnica }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Criterio_Solvencia_tecnica')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Condiciones Especiales</th>
    <td>
      {{ anexoI.Condiciones_especiales }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Condiciones_especiales')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Penalidad por Incumplimiento</th>
    <td>
      {{ anexoI.Penalidad_incumplimiento }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Penalidad_incumplimiento')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Forma de Pago</th>
    <td>
      {{ anexoI.Forma_pago }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Forma_pago')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Causas de Modificaci贸n</th>
    <td>
      {{ anexoI.Causas_modificacion }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Causas_modificacion')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Plazo de Garant铆a</th>
    <td>
      {{ anexoI.Plazo_garantia }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Plazo_garantia')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Contrataci贸n Precio Unitario</th>
    <td>
      {{ anexoI.Contratacion_precio_unit }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Contratacion_precio_unit')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Tanto alzado</th>
    <td>
      {{ anexoI.Tanto_alzado }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Tanto_alzado')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Tanto alzado con</th>
    <td>
      {{ anexoI.Tanto_alzado_con }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Tanto_alzado_con')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Criterio Juicio de Valor</th>
    <td>
      {{ anexoI.Criterio_juicio_val }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Criterio_juicio_val')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Evaluables Autom谩ticamente</th>
    <td>
      {{ anexoI.Evaluables_autom }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Evaluables_autom')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Criterio Econ贸mico</th>
    <td>
      {{ anexoI.Criterio_ec贸nomico }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Criterio_ec贸nomico')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>Obligaciones Ambientales</th>
    <td>
      {{ anexoI.Obligaciones_ambientales }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Obligaciones_ambientales')">Ubicar en el documento</button>
    </td>
  </tr>
  <tr>
    <th>R茅gimen de Penalidades</th>
    <td>
      {{ anexoI.Regimen_penalidades }}
      <button class="btn btn-outline-info btn-sm float-end" onclick="mostrarUbicacion('Regimen_penalidades')">Ubicar en el documento</button>
    </td>
  </tr>
</table>

<!-- Modal Bootstrap para mostrar la ubicaci贸n -->
<div class="modal fade" id="ubicacionModal" tabindex="-1" aria-labelledby="ubicacionModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ubicacionModalLabel">Ubicaci贸n en el documento</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body" id="ubicacionModalBody">
        <!-- Aqu铆 se mostrar谩 la informaci贸n de fuente -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<!-- Bloque de datos JSON seguro -->
<script type="application/json" id="anexoI-fuentes-data">
  {{ anexoI_fuentes|default:"{}"|safe }}
</script>

<script>
  let anexoI_fuentes = {};
  try {
    anexoI_fuentes = JSON.parse(document.getElementById('anexoI-fuentes-data').textContent);
  } catch (e) {
    anexoI_fuentes = {};
    console.warn("anexoI-fuentes-data JSON inv谩lido o vac铆o");
  }
  console.log(anexoI_fuentes); // <-- A帽ade esto para depurar

  function mostrarUbicacion(campo) {
    console.log("Mostrando ubicaci贸n para el campo:", campo);
    const fuente = anexoI_fuentes[campo];
    console.log("Fuente encontrada:", fuente);
    let mensaje = "Informaci贸n no disponible.";
    if (fuente) {
      mensaje = fuente;
    }
    document.getElementById('ubicacionModalBody').innerHTML = mensaje;
    var myModal = new bootstrap.Modal(document.getElementById('ubicacionModal'));
    myModal.show();
  }
</script>

<a href="{% url 'app:licitaciones' %}" class="btn btn-secondary mt-3">Volver a licitaciones</a>

{% else %}
<p class="text-danger">No se encontraron detalles para esta licitaci贸n.</p>
{% endif %}

{% endblock %}